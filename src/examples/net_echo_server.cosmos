require('net', net)
require('streampool', streampool)

rel client(in, out)
  io.fileRead(in, msg)
  streampool.delete(in)
  io.fileWrite(out, msg)
  io.close(in)
  io.close(out)

rel accept(socket)
  net.accept(socket, slave, peer)
  net.open(slave, in, out)
  streampool.add(in, @client(in, out))

rel main()
  net.socket(socket)
  net.bind(socket, 3000)
  net.listen(socket, 5)
  net.open(socket, in, out)
  streampool.add(in, @accept(socket)) 
  streampool.loop()
